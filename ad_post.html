<!DOCTYPE html>
<html lang="en">

<head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Post Your Ad</title>
      <link rel="stylesheet" href="ad_post.css">
      <style>
          
      </style>
</head>


<body>
<nav>
      <a id="read" href="./fetchDB.html">Read Data</a>
</nav>


      <div class="box">
            <video autoplay loop muted plays-inline class="bg-clip">
                  <source src="./assets/bg.mp4">
            </video>
            <div class="form">
                  <h2 id="heading">Please enter your details</h2>
                  <form id="userForm">
                        <div class="inputbox">
                              <input type="text" id="name" required placeholder="Name">

                        </div>
                        <div class="inputbox">
                              <input type="email" id="email" required placeholder="E-mail">

                        </div>
                        <div class="inputbox">
                              <input type="tel" id="phone" required placeholder="Phone Number" maxlength="10"
                                    minlength="10">

                        </div>
                        <div class="inputbox">
                              <input type="text" id="address" required placeholder="Address">

                        </div>
                        <div class="inputbox">
                              <input type="file" id="photos" accept="image/*" multiple required>

                        </div>
                        <input type="submit" value="Submit" class="sub" id="submit">
                  </form>
                  <div id="error-message"></div>
            </div>
      </div>
      <div id="loader" style="display: none;"></div>


      <script type="module">
            // Firebase imports and configuration...
            // Firebase imports
            import { initializeApp } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-app.js";
            import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-database.js";
            import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-storage.js";

            // Firebase configuration
            const firebaseConfig = {
                  // Replace with our Firebase configuration
               
            };

            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const db = getDatabase(app);
            const storage = getStorage(app);

            // Function definitions
            const userForm = document.getElementById('userForm');
            const errorMessage = document.getElementById('error-message');
            const loader = document.getElementById('loader');
            const popup = document.getElementById('popup');

            userForm.addEventListener('submit', async function (e) {
                  e.preventDefault();
                  loader.style.display = 'block';

                  const name = document.getElementById("name").value.trim();
                  const email = document.getElementById("email").value.trim();
                  const phone = document.getElementById("phone").value.trim();
                  const address = document.getElementById("address").value.trim();
                 
                  const photos = document.getElementById("photos").files;



                  const userData = {
                        phone,
                        email,
                        name,
                        address,
                        photoURLs: []
                  };

                  try {
                        await Promise.all([...photos].map(async (photo, i) => {
                              const photoStorageRef = storageRef(storage, `photos/${name}_${Date.now()}_${i}`);
                              const snapshot = await uploadBytes(photoStorageRef, photo);
                              const downloadURL = await getDownloadURL(snapshot.ref);
                              userData.photoURLs.push(downloadURL);
                        }));

                        await saveUserData(userData);
                        loader.style.display = 'none';
                        console.log(userData);
                        alert("data saved sucessfully")
                        userForm.reset();
                        window.location.href     ='./fetchDB.html'
                  } catch (error) {
                        showError("Error: " + error.message);
                        loader.style.display = 'none';
                  }
            });

            function saveUserData(userData) {
                  return set(ref(db, 'user/' + userData.name), userData);
            }

            function showError(message) {
                  errorMessage.textContent = message;
            }


      </script>
</body>

</html>